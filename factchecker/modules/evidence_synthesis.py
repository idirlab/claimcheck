from modules.llm import prompt_ollama

develop_prompt = """
Instructions
You just retrieved new Evidence. Now, analyze the Claim's veracity using the evidence. Always adhere to the following rules:
Focus on developing new insights. Do not repeat larger parts from the Record. Do not restate the Claim.
Write down your thoughts step-by-step. Whenever necessary, you may elaborate in more detail.
Depending on the topic's complexity, invest one to three paragraphs. The fewer, the better.
If you find that there is insufficient information to verify the Claim, explicitly state what information is missing.
If you cite web sources, always refer to them by including their URL as a Markdown hyperlink.
Use information only from the recorded evidence:
Avoid inserting information that is not implied by the evidence. You may use commonsense knowledge, though.

If it is extremely necessary to retrieve more evidence, you can propose actions to the user. If not necessary, do not add anything else other than the reasoning. 
Adhere to the following rules:
The actions available are listed under Valid Actions, including a short description for each action. No other actions are possible at this moment.
For each action, use the formatting as specified in Valid Actions.
Propose as few actions as possible but as much as needed. Do not propose similar or previously used actions.
Include all actions in a single Markdown code block at the end of your answer.

Valid Actions:
geolocate: Determine the country where an image was taken by providing an image ID.
reverse search: Perform a reverse image search on the web for similar images.
web search: Run an open web search for related webpages.
image search: Retrieve related images for a given query.
NONE: Do not propose any actions.

Examples:
geolocate(<image:k>)
reverse_search(<image:k>)
web_search("New Zealand Food Bill 2020")
image_search("China officials white suits carry people")
NONE

Record:
{record}
Your Analysis:
"""

def develop(record, think=True):
    """
    Develops an analysis of the claim using the provided record.

    Args:
        record (str): The record containing evidence for the analysis.
        think (bool): Whether to use chain-of-thought (default True)
    Returns:
        str: The analysis generated by the LLM.
    """
    prompt = develop_prompt.format(record=record)
    return prompt_ollama(prompt, think=think)